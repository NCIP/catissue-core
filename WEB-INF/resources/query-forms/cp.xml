#macro(getMessage $code)$messageSource.getMessage($code, null, $locale)#end

<form>
  <view>
    <name>CollectionProtocol</name>
    <caption>#getMessage("cp")</caption>
    <table>CATISSUE_COLLECTION_PROTOCOL</table>
    <activeCondition>ACTIVITY_STATUS != 'Disabled'</activeCondition>
    <row>
      <numberField>
        <name>id</name>
        <udn>id</udn>
        <caption>#getMessage("cp_identifier")</caption>
        <column>IDENTIFIER</column>
        <recordUrl>#/cps/:value/overview</recordUrl>
      </numberField>
    </row>
    <row>
      <dropDown>
        <name>shortTitle</name>
        <udn>shortTitle</udn>
        <caption>#getMessage("cp_short_title")</caption>
        <column>SHORT_TITLE</column>
        <recordUrl>#/object-state-params-resolver?stateName=cp-detail.overview&amp;objectName=cp&amp;key=shortTitle&amp;value=:value</recordUrl>
        <options>
          <sql>select distinct SHORT_TITLE from CATISSUE_COLLECTION_PROTOCOL</sql>
        </options>
      </dropDown>
    </row>
    <row>
      <textField>
        <name>title</name>
        <udn>Title</udn>
        <caption>#getMessage("cp_title")</caption>
        <column>TITLE</column>
        <recordUrl>#/object-state-params-resolver?stateName=cp-detail.overview&amp;objectName=cp&amp;key=title&amp;value=:value</recordUrl>
      </textField>
    </row>
    <row>
      <textField>
        <name>irbIdentifier</name>
        <udn>irbIdentifier</udn>
        <caption>#getMessage("cp_irb_id")</caption>
        <column>IRB_IDENTIFIER</column>
      </textField>
    </row>
    <row>
      <datePicker>
        <name>startDate</name>
        <udn>startDate</udn>
        <caption>#getMessage("cp_start_date")</caption>
        <column>START_DATE</column>
      </datePicker>
    </row>
    <row>
      <datePicker>
        <name>endDate</name>
        <udn>endDate</udn>
        <caption>#getMessage("cp_end_date")</caption>
        <column>END_DATE</column>
      </datePicker>
    </row>
    <row>
      <dropDown>
        <name>activityStatus</name>
        <udn>activityStatus</udn>
        <caption>#getMessage("cp_activity_status")</caption>
        <column>ACTIVITY_STATUS</column>
        <options>
          <option><value>Active</value></option>
          <option><value>Disabled</value></option>
          <option><value>Closed</value></option>
        </options>
      </dropDown>
    </row>
    <row>
      <subForm>
        <name>principalInvestigator</name>
        <udn>principalInvestigator</udn>
        <caption>#getMessage("cp_pi")</caption>
        <table>USER_VIEW</table>
        <foreignKey>IDENTIFIER</foreignKey>
        <parentKey>PRINCIPAL_INVESTIGATOR_ID</parentKey>
        <row>     
          <userField>
            <name>investigatorName</name>
            <udn>investigatorName</udn>
            <caption>#getMessage("cp_pi_name")</caption>
            <column>IDENTIFIER</column>
          </userField> 
               
          <textField>
            <name>email</name>
            <udn>email</udn>
            <caption>#getMessage("cp_pi_email")</caption>
            <column>EMAIL_ADDRESS</column>
          </textField>

          <dropDown>
            <name>department</name>
            <udn>department</udn>
            <caption>#getMessage("cp_pi_department")</caption>
            <column>DEPARTMENT_NAME</column>
            <options>
              <sql>select distinct DEPARTMENT_NAME from USER_VIEW</sql>
            </options>
          </dropDown>
        </row>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>coordinator</name>
        <udn>coordinator</udn>
        <caption>#getMessage("cp_coordinator")</caption>
        <table>CP_COORD_VIEW</table>
        <foreignKey>CP_ID</foreignKey>
        <parentKey>IDENTIFIER</parentKey>
        <row>
          <userField>
            <name>coordinatorName</name>
            <udn>coordinatorName</udn>
            <caption>#getMessage("cp_coordinator_name")</caption>
            <column>IDENTIFIER</column>
          </userField>   
          
          <textField>
            <name>email</name>
            <udn>email</udn>
            <caption>#getMessage("cp_coordinator_email")</caption>
            <column>EMAIL_ADDRESS</column>
          </textField>
                    
          <dropDown>
            <name>department</name>
            <udn>department</udn>
            <caption>#getMessage("cp_coordinator_department")</caption>
            <column>DEPARTMENT_NAME</column>
            <options>
              <sql>select distinct DEPARTMENT_NAME from USER_VIEW</sql>
            </options>
          </dropDown>
        </row>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>customFields</name>
        <udn>customFields</udn>
        <caption>#getMessage("cp_field_extensions")</caption>
        <table>OS_CP_CUST_FIELD_EXTNS_VIEW</table>
        <foreignKey>CP_ID</foreignKey>
        <parentKey>IDENTIFIER</parentKey>
        <pathLink>true</pathLink>
        <extnFkCol>RECORD_ID</extnFkCol>
      </subForm>
    </row>
  </view>
</form>
