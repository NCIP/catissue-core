#macro(getMessage $code)$messageSource.getMessage($code, null, $locale)#end

<form>
  <view>
    <name>SpecimenCollectionGroup</name>
    <caption>#getMessage("visit")</caption>
    <table>CATISSUE_SPECIMEN_COLL_GROUP</table>
    <activeCondition>ACTIVITY_STATUS != 'Disabled'</activeCondition>
    <row>
      <numberField>
        <name>id</name>
        <udn>id</udn>
        <caption>#getMessage("visit_identifier")</caption>
        <column>IDENTIFIER</column>
        <recordUrl>#/object-state-params-resolver?stateName=visit-detail.overview&amp;objectName=visit&amp;key=id&amp;value=:value</recordUrl>
      </numberField>
    </row>
    <row>
      <textField>
        <name>name</name>
        <udn>name</udn>
        <caption>#getMessage("visit_name")</caption>
        <column>NAME</column>
        <recordUrl>#/object-state-params-resolver?stateName=visit-detail.overview&amp;objectName=visit&amp;key=name&amp;value=:value</recordUrl>
      </textField>
    </row>
    <row>
      <dropDown>
        <name>activityStatus</name>
        <udn>activityStatus</udn>
        <caption>#getMessage("visit_activity_status")</caption>
        <column>ACTIVITY_STATUS</column>
        <options>
          <option><value>Active</value></option>
          <option><value>Disabled</value></option>
          <option><value>Closed</value></option>
        </options>
      </dropDown>
    </row>
    <row>
      <textField>
        <name>barcode</name>
        <udn>barcode</udn>
        <caption>#getMessage("visit_barcode")</caption>
        <column>BARCODE</column>
      </textField>
    </row>
    <row>
      <subForm>
        <name>site</name>
        <udn>site</udn>
        <caption>#getMessage("visit_site")</caption>
        <table>CATISSUE_SITE</table>
        <foreignKey>IDENTIFIER</foreignKey>
        <parentKey>SITE_ID</parentKey>
        <row>
          <dropDown>
            <name>name</name>
            <udn>name</udn>
            <caption>#getMessage("visit_site")</caption>
            <column>NAME</column>
            <options>
              <sql>select distinct name from CATISSUE_SITE</sql>
            </options>
            <recordUrl>#/object-state-params-resolver?stateName=site-detail.overview&amp;objectName=site&amp;key=name&amp;value=:value</recordUrl>
          </dropDown>
        </row>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>collectionProtocolEvent</name>
        <udn>collectionProtocolEvent</udn>
        <caption>#getMessage("visit_cpe")</caption>
        <table>CATISSUE_COLL_PROT_EVENT</table>
        <foreignKey>IDENTIFIER</foreignKey>
        <parentKey>COLLECTION_PROTOCOL_EVENT_ID</parentKey>
        <row>
          <textField>
            <name>collectionPointLabel</name>
            <udn>collectionPointLabel</udn>
            <caption>#getMessage("visit_cpe_label")</caption>
            <column>COLLECTION_POINT_LABEL</column>
          </textField>
        </row>
      </subForm>
    </row>
    <row>
      <dropDown>
        <name>collectionStatus</name>
        <udn>collectionStatus</udn>
        <caption>#getMessage("visit_status")</caption>
        <column>COLLECTION_STATUS</column>
        <options>
          <option><value>Pending</value></option>
          <option><value>Complete</value></option>
          <option><value>Incomplete</value></option>
          <option><value>Missed Collection</value></option>
        </options>
      </dropDown>
    </row>
    <row>
      <dropDown>
        <name>missedReason</name>
        <udn>missedReason</udn>
        <caption>#getMessage("visit_missed_reason")</caption>
        <column>MISSED_REASON</column>
        <options>
          <sql>select value from catissue_permissible_value where PUBLIC_ID = 'missed_visit_reason' order by value</sql>
        </options>
      </dropDown>
    </row>
    <row>
      <subForm>
        <name>missedBy</name>
        <udn>missedBy</udn>
        <caption>#getMessage("visit_missed_by")</caption>
        <table>USER_VIEW</table>
        <foreignKey>IDENTIFIER</foreignKey>
        <parentKey>MISSED_BY</parentKey>
        <row>
          <userField>
            <name>missedByName</name>
            <udn>missedByName</udn>
            <caption>#getMessage("visit_missed_by")</caption>
            <column>IDENTIFIER</column>
          </userField>
        </row>
        <row>  
          <dropDown>
            <name>department</name>
            <udn>department</udn>
            <caption>#getMessage("visit_missed_by_department")</caption>
            <column>DEPARTMENT_NAME</column>
            <options>
              <sql>select distinct DEPARTMENT_NAME from USER_VIEW</sql>
            </options>
          </dropDown>
        </row>
        <row>        
          <dropDown>
            <name>institute</name>
            <udn>institute</udn>
            <caption>#getMessage("visit_missed_by_institute")</caption>
            <column>INSTITUTE_NAME</column>
            <options>
              <sql>select distinct INSTITUTE_NAME from USER_VIEW</sql>
            </options>
          </dropDown>  
        </row>
      </subForm>
    </row>
    <row>
      <dropDown>
        <name>clinicalDiagnosis</name>
        <udn>clinicalDiagnosis</udn>
        <caption>#getMessage("visit_clinical_diagnosis")</caption>
        <column>CLINICAL_DIAGNOSIS</column>
        <options>
          <!-- sql>select value from catissue_permissible_value where public_id = 'Clinical_Diagnosis_PID' order by sortorder, value</sql -->
          <sql>select distinct CLINICAL_DIAGNOSIS from CATISSUE_SPECIMEN_COLL_GROUP</sql>
        </options>
      </dropDown>
    </row>
    <row>
      <dropDown>
        <name>clinicalStatus</name>
        <udn>clinicalStatus</udn>
        <caption>#getMessage("visit_clinical_status")</caption>
        <column>CLINICAL_STATUS</column>
        <options>
          <sql>select value from catissue_permissible_value where PUBLIC_ID = '2003988' order by value</sql>
        </options>
      </dropDown>
    </row>
    <row>
      <dropDown>
        <name>cohort</name>
        <udn>cohort</udn>
        <caption>#getMessage("visit_cohort")</caption>
        <column>COHORT</column>
        <options>
          <sql>select value from catissue_permissible_value where PUBLIC_ID = 'cohort' order by value</sql>
        </options>
      </dropDown>
    </row>
    <row>
      <textField>
        <name>surgicalPathologyNo</name>
        <udn>surgicalPathologyNo</udn>
        <caption>#getMessage("visit_surgical_pathology_number")</caption>
        <column>SURGICAL_PATHOLOGY_NUMBER</column>
        <phi>true</phi>
      </textField>
    </row>
    <row>
      <datePicker>
        <name>collectionDate</name>
        <udn>collectionDate</udn>
        <caption>#getMessage("visit_date")</caption>
        <column>COLLECTION_TIMESTAMP</column>
      </datePicker>
    </row>
    <row>
      <textField>
        <name>spr</name>
        <udn>spr</udn>
        <caption>#getMessage("visit_spr")</caption>
        <column>SPR_NAME</column>
      </textField>
    </row>
    <row>
      <textField>
        <name>comments</name>
        <udn>comments</udn>
        <caption>#getMessage("visit_comments")</caption>
        <column>COMMENTS</column>
      </textField>
    </row>
    <row>
      <subForm>
        <name>specimens</name>
        <udn>specimens</udn>
        <caption>#getMessage("visit_specimens")</caption>
        <table>CATISSUE_SPECIMEN</table>
        <foreignKey>SPECIMEN_COLLECTION_GROUP_ID</foreignKey>
        <parentKey>IDENTIFIER</parentKey>
        <pathLink>true</pathLink>
        <row>
          <subForm>
            <name>specimenOrders</name>
            <udn>specimenOrders</udn>
            <caption>#getMessage("visit_specimens_order_items")</caption>
            <table>OS_ORDER_ITEMS</table>
            <foreignKey>SPECIMEN_ID</foreignKey>
            <parentKey>IDENTIFIER</parentKey>
            <row>
              <subForm>
                <name>order</name>
                <udn>order</udn>
                <caption>#getMessage("visit_specimens_order_items_order")</caption>
                <table>OS_ORDERS</table>
                <foreignKey>IDENTIFIER</foreignKey>
                <parentKey>ORDER_ID</parentKey>
              </subForm>
            </row>
          </subForm>
        </row>
        
        <row>
          <subForm>
            <name>specimenShipments</name>
            <udn>specimenShipments</udn>
            <caption>#getMessage("specimen_shipment_items")</caption>
            <table>OS_SHIPMENT_ITEMS</table>
            <foreignKey>SPECIMEN_ID</foreignKey>
            <parentKey>IDENTIFIER</parentKey>
           
            <row>
              <subForm>
                <name>shipment</name>
                <udn>shipment</udn>
                <caption>#getMessage("specimen_shipment_items_shipment")</caption>
                <table>OS_SHIPMENTS</table>
                <foreignKey>IDENTIFIER</foreignKey>
                <parentKey>SHIPMENT_ID</parentKey>
              </subForm>
            </row>
          </subForm>
        </row>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>customFields</name>
        <udn>customFields</udn>
        <caption>#getMessage("visit_field_extensions")</caption>
        <table>OS_VISIT_CUST_FIELD_EXTNS_VIEW</table>
        <foreignKey>SCG_ID</foreignKey>
        <parentKey>IDENTIFIER</parentKey>
        <pathLink>true</pathLink>
        <extnFkCol>RECORD_ID</extnFkCol>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>extensions</name>
        <udn>extensions</udn>
        <caption>#getMessage("visit_extensions")</caption>
        <table>SCG_EXTN_RECORDS_VIEW</table>
        <foreignKey>SCG_ID</foreignKey>
        <parentKey>IDENTIFIER</parentKey>
        <pathLink>true</pathLink>
        <extnFkCol>RECORD_ID</extnFkCol>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>participant</name>
        <udn>participant</udn>
        <caption>#getMessage("participant")</caption>
        <table>CPR_VIEW</table>
        <foreignKey>CPR_ID</foreignKey>
        <parentKey>COLLECTION_PROTOCOL_REG_ID</parentKey>
        <pathLink>true</pathLink>
      </subForm>
    </row>
  </view>
</form>
